## è¿™æ˜¯ä¸€ä¸ªåŸºäºpandasaiå’Œstreamlitçš„æ•°æ®é—®ç­”ç³»ç»Ÿ  

### ç®€ä»‹ï¼šç”¨æˆ·å¯ä»¥ä¼ å…¥csvæˆ–excelè¡¨æ ¼æ–‡ä»¶ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œæé—®ã€‚ç•Œé¢å¦‚ä¸‹:  
![æ•°æ®é—®ç­”ç³»ç»Ÿ](/image/æ•°æ®å±•ç¤º/å±•ç¤º.png)

  
è®¾è®¡ç”¨æˆ·å…±æœ‰å››ä¸ªæ¨¡å‹å¯ä»¥é€‰æ‹©ï¼š
* ç«å±±å¼•æ“
* Openaiï¼ˆæœ‰éœ€è¦ä»£ç†é—®é¢˜ï¼‰
* ollama(åœ¨æœ¬åœ°æœ‰è¿è¡Œæ…¢çš„é—®é¢˜)
* Groqï¼ˆåŒæ ·æœ‰ä»£ç†é—®é¢˜ï¼‰
  
### æ ¸å¿ƒä»£ç è§£è¯»:
#### 1.å¯¼å…¥æ ¸å¿ƒæ¨¡å—
```commandline
import streamlit as st 
import pandas as pd
from pandasai.llm import OpenAI
from langchain_groq.chat_models import ChatGroq
from langchain_community.llms import Ollama
from pandasai import SmartDataframe, clear_cache
from pandasai.connectors import MySQLConnector
from pandasai.responses.streamlit_response import StreamlitResponse
from io import StringIO, BytesIO
import sys
import matplotlib.pyplot as plt
from PIL import Image
from huoshan import VolcanoLLM

plt.rcParams['font.sans-serif'] = ['SimHei']  # ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾
plt.rcParams['axes.unicode_minus'] = False    # ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºè´Ÿå·
```

#### 2.è®¾ç½®æ ‡é¢˜ï¼Œå’Œä¼ å…¥æ•°æ®æ¨¡å—(æ•°æ®å¯é€šè¿‡ä¸Šä¼ å’Œæ•°æ®åº“çš„æ–¹å¼ä¼ å…¥)
```commandline
st.set_page_config(page_title="Talk to Your Data")
st.title("Talk to Your Data ğŸ¼")

# ä¸Šä¼  CSV æˆ– Excel æ–‡ä»¶
uploaded_file = st.sidebar.file_uploader("Upload your CSV or Excel file", type=["csv", "xlsx"])
data = None
    if uploaded_file is not None:
        if uploaded_file.name.endswith(".csv"):
            data = pd.read_csv(uploaded_file)
        elif uploaded_file.name.endswith(".xlsx"):
            data = pd.read_excel(uploaded_file)

# è¾“å…¥ SQL æ•°æ®åº“è¿æ¥ä¿¡æ¯
db_connection = None

#if st.sidebar.button("Setup Database Connection"):
with st.sidebar.expander("Database Connection Settings", expanded=True):
     hostname = st.text_input("Hostname", disabled=uploaded_file is not None)
     port = st.text_input("Port", disabled=uploaded_file is not None)
     username = st.text_input("Username", disabled=uploaded_file is not None)
     password = st.text_input("Password", type="password", disabled=uploaded_file is not None)
     db_name = st.text_input("Database Name", disabled=uploaded_file is not None)
     table = st.text_input("Table", disabled=uploaded_file is not None)
        
#if st.button("Connect to SQL Database"):
     if hostname and port and username and password and db_name and table:
        db_connection = MySQLConnector(
                config={
                    "host": hostname,
                    "port": port,
                    "database": db_name,
                    "username": username,
                    "password": password,
                    "table": table,
                }
            )

     if not db_connection:
        st.error(f"Error connecting to database: {e}")

     else:
        data = db_connection.pandas_df  # åŠ è½½æ•°æ®
                
if data is not None:
    st.write(data)

```

#### 2.2ç”¨æˆ·é€‰æ‹©pandasaiä¼ å…¥çš„å¤§æ¨¡å‹
```commandline
    # é€‰æ‹©å¤§è¯­è¨€æ¨¡å‹
    llm_choice = st.sidebar.selectbox("Choose a Language Model", ["Ollama", "OpenAI", "Groq","ç«å±±"])

    openai_api_key = ""
    groq_api_key = ""
    huoshan_api_key = ""
    huoshan_endid = ""
    if llm_choice == "OpenAI":
        # è¾“å…¥ OpenAI API Key
        openai_api_key = st.sidebar.text_input("OpenAI API Key", type="password", disabled=not (uploaded_file or db_connection)) 
        if not openai_api_key.startswith("sk-"):
            st.warning("Please enter your OpenAI API key!", icon="âš ï¸")
    elif llm_choice == "Groq":
        # è¾“å…¥ Groq API Key
        groq_api_key = st.sidebar.text_input("Groq API Key", type="password", disabled=not (uploaded_file or db_connection)) 
        if not groq_api_key.startswith("gsk_"):
            st.warning("Please enter your Groq API key!", icon="âš ï¸")
    elif llm_choice == "ç«å±±":
        # è¾“å…¥ Groq API Key
        huoshan_api_key = st.sidebar.text_input("ç«å±± API KEY", type="password", disabled=not (uploaded_file or db_connection))
        huoshan_endid = st.sidebar.text_input("ç«å±± MODEL KEY", type="password",disabled=not (uploaded_file or db_connection))


    def get_llm(choice, api_key=None):
        if choice == "OpenAI":
            return OpenAI(api_token=api_key)
        elif choice == "Groq":
            return ChatGroq(model_name='llama3-70b-8192', api_key=api_key)
        elif choice == "Ollama":
            return Ollama(model="llama3.1")
        elif choice == "ç«å±±":
            return VolcanoLLM(api_base="https://ark.cn-beijing.volces.com/api/v3/chat/completions",api_key=huoshan_api_key,model=huoshan_endid)
        else:
            return None
```

#### 2.3å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œå“åº”
```commandline
    def generate_response(data, prompt, llm):
        df = SmartDataframe(data, config={
            "llm": llm,
            "custom_whitelisted_dependencies": whitelist,
            "response_parser": StreamlitResponse
        })

        # æ•è·æ ‡å‡†è¾“å‡ºä»¥è·å– PandasAI çš„æ‰“å°å†…å®¹a
        old_stdout = sys.stdout
        sys.stdout = StringIO()

        response = df.chat(prompt)
        if 'exports/charts/temp_chart.png' in response:
            image_path = response
            image = Image.open(image_path)
            st.image(image, caption='Generated Chart by PandasAI', use_column_width=True)
        else:
            st.write(response)
        st.write("All prompts:")
        for i, p in enumerate(st.session_state.prompts):
            st.write(f"{i}: {p}")
```